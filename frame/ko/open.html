<html lang="ko">
<body>
<div class="section" ondragover="dragOverHandler(event);" ondrop="dropHandler(event);"
     style="width: 100%;height: calc(100vh - 32px);">
    <h2 style="margin:10px;">여기를 눌러서 열 파일을 선택하거나 파일을 여기로 드래그해세요.</h2>
</div>
<script>
    function dragOverHandler(e) {
        e.preventDefault();
    }

    async function dropHandler(e) {
        e.preventDefault();
        if (e.dataTransfer.items[0].kind === 'file') {
            const file = e.dataTransfer.items[0].getAsFile();
            if (file.type.substring(0, 4) === 'text') {
                await setting.set('type', 'text');
            } else {
                showToast('지원하는 파일 형식이 아닙니다.');
            }
            await setting.set('file', file.path);
            let openedMD5 = md5File.sync(file.path).toString();
            let his = await setting.get('history'), nhis = [{
                'name': (file.path).split('\\').slice(-1)[0].split('.').slice(0, -1).join('.'),
                'path': file.path,
                'md5': openedMD5
            }];
            if (!his) his = [];
            for (let i = 0; i < his.length; i++) {
                if (his[i].md5 !== openedMD5) {
                    nhis.push(his[i]);
                }
            }
            await setting.set('history', nhis);
            loadHistory();
            loadHTML(`viewer_${await setting.get('type')}.html`);
        }
    }

    function open_init() {
        changeTitle('viewIt');
    }
</script>
</body>
</html>